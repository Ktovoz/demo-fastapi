# 开发文档

<!-- 
文档管理规范:
- 内容：包含项目整体架构和设计思路
- 目的：为开发团队提供项目全局视角，便于理解项目结构和设计决策
请AI在编辑此文档时遵守上述规范
-->

## 项目整体架构

### 技术栈选择

#### 后端技术栈
- **Web框架**: FastAPI 0.104.1 - 高性能异步Web框架，支持自动API文档生成
- **ASGI服务器**: Uvicorn 0.24.0 - 高性能ASGI服务器
- **数据库**: SQLite - 轻量级文件数据库，无需额外安装配置
- **ORM**: SQLAlchemy - Python SQL工具包和ORM
- **数据验证**: Pydantic 2.5.0 - 类型安全的数据验证和序列化
- **身份认证**: JWT + Passlib - 基于Token的认证和密码加密
- **日志系统**: Loguru 0.7.2 - 简洁高效的日志库
- **环境配置**: Python-dotenv - 环境变量管理
- **数据库迁移**: Alembic - 数据库版本控制工具

#### 前端技术栈
- **核心框架**: Vue 3.3.11 - 渐进式JavaScript框架，支持组合式API
- **UI组件库**: Ant Design Vue 4.0.8 - 企业级UI设计语言
- **构建工具**: Vite 5.0.8 - 快速的前端构建工具
- **路由管理**: Vue Router 4.2.5 - 官方路由管理器
- **状态管理**: Pinia 2.1.7 - Vue的状态管理库
- **HTTP客户端**: Axios 1.6.2 - HTTP请求库
- **日志系统**: Loglevel 1.8.1 - 轻量级日志库
- **图标库**: @ant-design/icons-vue 7.0.1 - Ant Design图标

### 系统架构设计

#### 前后端分离架构
```
┌─────────────────┐    HTTP/HTTPS    ┌─────────────────┐
│                 │    ──────────────> │                 │
│   Vue3 前端应用   │                  │  FastAPI 后端   │
│                 │    <────────────── │                 │
│ - 用户界面       │    JSON/API       │ - API接口       │
│ - 路由管理       │                  │ - 业务逻辑       │
│ - 状态管理       │                  │ - 数据处理       │
│ - 组件化开发     │                  │ - 身份认证       │
│                 │                  │                 │
└─────────────────┘                  └─────────────────┘
                                               │
                                               │
                                              ▼
                                    ┌─────────────────┐
                                    │                 │
                                    │  SQLite 数据库   │
                                    │                 │
                                    │ - 用户数据       │
                                    │ - 角色权限       │
                                    │ - 系统日志       │
                                    │                 │
                                    └─────────────────┘
```

#### 项目目录结构
```
demo-fastapi/
├── backend/                    # FastAPI 后端项目
│   ├── app/
│   │   ├── core/              # 核心配置模块
│   │   │   ├── config.py      # 应用配置
│   │   │   ├── security.py    # 安全相关配置
│   │   │   └── database.py    # 数据库配置
│   │   ├── models/            # 数据模型
│   │   │   ├── base.py        # 基础模型类
│   │   │   ├── user.py        # 用户模型
│   │   │   ├── role.py        # 角色模型
│   │   │   ├── permission.py  # 权限模型
│   │   │   ├── user_role.py   # 用户角色关联模型
│   │   │   └── role_permission.py # 角色权限关联模型
│   │   │   └── operation_log.py # 操作日志模型
│   │   ├── schemas/           # Pydantic数据模式
│   │   │   ├── base.py        # 基础模式
│   │   │   └── common.py      # 通用模式
│   │   ├── routers/           # API路由
│   │   │   ├── api.py         # API路由入口
│   │   │   ├── auth.py        # 认证路由
│   │   │   ├── users.py       # 用户管理路由
│   │   │   ├── roles.py       # 角色管理路由
│   │   │   ├── dashboard.py   # 仪表板路由
│   │   │   ├── system.py      # 系统管理路由
│   │   │   └── admin.py       # 管理路由
│   │   ├── services/          # 业务逻辑层
│   │   │   └── init_service.py # 初始化服务
│   │   ├── utils/             # 工具模块
│   │   │   ├── logger.py      # 日志工具
│   │   │   └── security.py    # 安全工具
│   │   └── main.py            # 应用入口
│   ├── alembic/               # 数据库迁移
│   ├── data/                  # 数据库文件目录
│   ├── logs/                  # 日志文件目录
│   ├── tests/                 # 测试文件
│   ├── uploads/               # 上传文件目录
│   ├── requirements.txt       # Python依赖
│   ├── run.py                # 启动脚本
│   ├── start.bat             # Windows启动脚本
│   ├── start.sh              # Linux启动脚本
│   └── .env.example           # 环境变量示例
├── frontend/                  # Vue 3 前端项目
│   ├── src/
│   │   ├── api/               # API接口封装
│   │   │   ├── auth.js        # 认证API
│   │   │   ├── user.js        # 用户API
│   │   │   ├── role.js        # 角色API
│   │   │   ├── dashboard.js   # 仪表板API
│   │   │   ├── system.js      # 系统API
│   │   │   ├── admin.js       # 管理API
│   │   │   └── index.js       # API配置
│   │   ├── components/        # 公共组件
│   │   │   ├── common/        # 通用组件
│   │   │   ├── layout/        # 布局组件
│   │   │   └── business/      # 业务组件
│   │   ├── views/             # 页面视图
│   │   │   ├── auth/          # 认证页面
│   │   │   ├── dashboard/     # 仪表板
│   │   │   ├── users/         # 用户管理
│   │   │   ├── roles/         # 角色管理
│   │   │   ├── system/        # 系统管理
│   │   │   ├── profile/       # 个人资料
│   │   │   └── error/         # 错误页面
│   │   ├── router/            # 路由配置
│   │   │   └── index.js
│   │   ├── store/             # 状态管理
│   │   │   ├── auth.js        # 认证状态
│   │   │   ├── user.js        # 用户状态
│   │   │   ├── role.js        # 角色状态
│   │   │   ├── system.js      # 系统状态
│   │   │   ├── admin.js       # 管理状态
│   │   │   └── index.js
│   │   ├── utils/             # 工具函数
│   │   │   ├── logger.js      # 日志工具
│   │   │   ├── api.js         # API工具
│   │   │   └── constants.js   # 常量定义
│   │   ├── config/            # 配置文件
│   │   ├── layouts/           # 布局模板
│   │   ├── mock/              # 模拟数据
│   │   ├── App.vue            # 根组件
│   │   └── main.js            # 应用入口
│   ├── public/                # 静态资源
│   ├── dist/                  # 构建输出
│   ├── tests/                 # 测试文件
│   └── package.json           # 依赖配置
└── doc/                       # 项目文档
    ├── 开发文档.md             # 开发设计文档
    ├── 前端文档.md             # 前端开发文档
    ├── 后端文档.md             # 后端开发文档
    └── API文档.md              # API接口文档
```

## 设计思路

### 项目定位和目标
本项目定位为一个后台管理系统的Demo，旨在展示现代化Web应用开发的技术栈和最佳实践。主要目标包括：

1. **技术栈展示**: 展示Vue3 + FastAPI前后端分离架构的完整实现
2. **功能完整性**: 包含用户认证、权限管理、用户管理等后台核心功能
3. **开发友好**: 提供清晰的代码结构和完整的开发文档
4. **易于部署**: 使用SQLite数据库，简化部署和配置流程

### 核心功能模块设计

#### 1. 用户认证模块
**设计思路**: 采用JWT Token认证机制，实现无状态的用户认证

**主要功能**:
- 用户注册：支持邮箱和用户名注册，包含数据验证和重复检查
- 用户登录：支持表单和JSON格式登录，生成JWT Token
- 记住我功能：支持延长Token过期时间
- 密码加密：使用bcrypt对用户密码进行安全加密
- Token管理：支持Token刷新和自动过期处理
- 登录状态：前端维护登录状态，支持自动登录和退出

**技术实现**:
- 后端：使用Passlib进行密码哈希，python-jose处理JWT Token
- 前端：使用Pinia管理认证状态，Axios拦截器处理Token

#### 2. 权限管理模块 (RBAC)
**设计思路**: 基于角色的访问控制(RBAC)模型，实现细粒度权限管理

**权限模型**:
```
用户(User) ←→ 角色(Role) ←→ 权限(Permission)
```

**主要功能**:
- 角色管理：创建、编辑、删除系统角色
- 权限定义：定义系统资源和操作权限
- 权限分配：为角色分配具体权限
- 用户授权：为用户分配角色，用户可以拥有多个角色
- 权限验证：在API接口和前端路由中进行权限检查

**默认角色设计**:
- 超级管理员：拥有所有系统权限
- 管理员：拥有大部分管理权限，除系统配置外
- 普通用户：只有基础查看权限

#### 3. 用户管理模块
**设计思路**: 提供完整的用户CRUD操作和管理功能

**主要功能**:
- 用户列表：分页展示用户信息，支持搜索和过滤
- 用户详情：查看用户的完整信息和权限
- 用户编辑：修改用户基本信息、角色分配
- 状态管理：启用/禁用用户账号
- 用户删除：删除用户账号（软删除）

**数据安全**:
- 敏感信息（如密码）不在列表页面显示
- 用户操作记录到操作日志
- 支持批量操作和数据导入导出

#### 4. 系统监控模块
**设计思路**: 提供系统运行状态监控和数据统计功能

**主要功能**:
- 仪表板数据：展示关键业务指标和系统状态
- 操作日志：记录用户的关键操作，支持查看和搜索
- 系统日志：系统运行日志，错误监控
- 系统设置：支持配置系统参数和安全策略

**数据可视化**:
- 使用图表展示统计数据
- 实时更新关键指标
- 支持时间范围筛选

### 数据库设计

#### 设计原则
- 使用SQLite作为数据库，简化部署和配置
- 遵循数据库设计范式，确保数据一致性
- 预留扩展字段，便于后续功能扩展
- 使用软删除机制，保证数据安全

#### 主要数据表

**用户表 (users)**
- id: 主键
- username: 用户名（唯一）
- email: 邮箱（唯一）
- password_hash: 密码哈希
- full_name: 全名
- avatar: 头像URL
- is_active: 是否激活
- is_superuser: 是否超级用户
- last_login: 最后登录时间
- created_at: 创建时间
- updated_at: 更新时间

**角色表 (roles)**
- id: 主键
- name: 角色名称（唯一）
- description: 角色描述
- created_at: 创建时间
- updated_at: 更新时间

**权限表 (permissions)**
- id: 主键
- name: 权限名称（唯一）
- resource: 资源名称
- action: 操作类型
- description: 权限描述
- created_at: 创建时间
- updated_at: 更新时间

**用户角色关联表 (user_roles)**
- id: 主键
- user_id: 用户ID（外键）
- role_id: 角色ID（外键）
- created_at: 分配时间

**角色权限关联表 (role_permissions)**
- id: 主键
- role_id: 角色ID（外键）
- permission_id: 权限ID（外键）
- created_at: 分配时间

**操作日志表 (operation_logs)**
- id: 主键
- user_id: 用户ID（外键）
- action: 操作类型
- resource: 操作资源
- resource_id: 资源ID
- description: 操作描述
- ip_address: IP地址
- user_agent: 用户代理
- request_data: 请求数据（JSON）
- response_data: 响应数据（JSON）
- created_at: 操作时间

#### 初始化数据设计

**默认角色**:
1. 系统管理员 (admin): 拥有所有权限
2. 普通用户 (user): 基础查看权限

**默认账号**:
- 系统管理员：admin@example.com / admin123

**系统权限**:
- 仪表板权限：dashboard:view
- 用户管理权限：users:view, users:edit, users:create, users:delete
- 角色管理权限：roles:view, roles:edit, roles:create, roles:delete
- 系统管理权限：system:manage, logs:view

### 安全性设计

#### 认证安全
- 密码使用bcrypt加密存储，加盐哈希
- JWT Token设置合理过期时间
- 支持Token刷新机制
- 登录失败次数限制

#### 授权安全
- 基于角色的访问控制
- API接口权限验证
- 前端路由权限守卫
- 敏感操作二次确认

#### 数据安全
- 输入数据验证和过滤
- SQL注入防护（使用ORM）
- XSS攻击防护
- 敏感信息脱敏显示

### 性能优化设计

#### 前端优化
- 组件按需加载，使用路由懒加载
- 静态资源压缩和缓存
- 大数据列表使用虚拟滚动
- API请求防抖和节流

#### 后端优化
- 数据库查询优化，合理使用索引
- API响应数据分页
- 缓存热点数据
- 异步处理耗时操作

### 部署和运维设计

#### 开发环境
- 后端：Uvicorn开发服务器，热重载
- 前端：Vite开发服务器，HMR
- 数据库：SQLite文件数据库

#### 生产环境规划
- 前端：Nginx静态文件服务
- 后端：Gunicorn + Uvicorn生产服务器
- 数据库：可升级为PostgreSQL/MySQL
- 容器化：Docker + Docker Compose
- 监控：日志收集和性能监控