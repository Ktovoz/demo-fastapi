# 前端文档

<!-- 
文档管理规范:
- 内容：包含前端技术栈和具体实现细节
- 目的：详细记录前端开发所使用的技术、框架及具体实现方式
请AI在编辑此文档时遵守上述规范
-->

## 技术栈

### 核心框架
- **Vue 3.3.11** - 渐进式JavaScript框架，支持组合式API
- **Vite 5.0.8** - 新一代前端构建工具，提供快速的开发服务器和构建工具

### UI组件库
- **Ant Design Vue 4.0.8** - 企业级UI设计语言，提供丰富的组件
- **@ant-design/icons-vue 7.0.1** - Ant Design图标库

### 状态管理
- **Pinia 2.1.7** - Vue的官方状态管理库，替代Vuex

### 路由管理
- **Vue Router 4.2.5** - Vue.js官方路由管理器

### 网络请求
- **Axios 1.6.2** - HTTP请求库，支持请求拦截和响应处理

### 日志系统
- **loglevel 1.8.1** - 轻量级日志库
- **loglevel-plugin-prefix** - 日志前缀插件

### 开发工具
- **ESLint** - 代码质量检查工具
- **Prettier** - 代码格式化工具

## 项目结构

```
frontend/
├── public/                     # 静态资源
│   ├── index.html             # HTML模板
│   └── favicon.ico            # 网站图标
├── src/                       # 源代码
│   ├── api/                   # API接口封装
│   │   ├── auth.js            # 认证相关API
│   │   ├── user.js            # 用户管理API
│   │   ├── role.js            # 角色管理API
│   │   ├── dashboard.js       # 仪表板API
│   │   └── index.js           # API配置和拦截器
│   ├── components/            # 公共组件
│   │   ├── common/            # 通用组件
│   │   │   ├── Loading.vue    # 加载组件
│   │   │   ├── Pagination.vue # 分页组件
│   │   │   └── SearchForm.vue # 搜索表单组件
│   │   └── layout/            # 布局组件
│   │       ├── Header.vue     # 头部导航
│   │       ├── Sidebar.vue    # 侧边栏
│   │       └── Footer.vue     # 底部
│   ├── views/                 # 页面视图
│   │   ├── auth/              # 认证页面
│   │   │   ├── Login.vue      # 登录页面
│   │   │   ├── Register.vue   # 注册页面
│   │   │   └── ForgotPassword.vue # 忘记密码
│   │   ├── dashboard/         # 仪表板
│   │   │   └── Index.vue      # 仪表板首页
│   │   ├── users/             # 用户管理
│   │   │   ├── UserList.vue   # 用户列表
│   │   │   ├── UserDetail.vue # 用户详情
│   │   │   └── UserEdit.vue   # 用户编辑
│   │   ├── roles/             # 角色管理
│   │   │   ├── RoleList.vue   # 角色列表
│   │   │   └── RoleEdit.vue   # 角色编辑
│   │   ├── system/            # 系统管理
│   │   │   ├── Logs.vue       # 操作日志
│   │   │   └── Settings.vue   # 系统设置
│   │   └── profile/           # 个人中心
│   │       └── Profile.vue    # 个人资料
│   ├── router/                # 路由配置
│   │   └── index.js           # 路由定义和守卫
│   ├── store/                 # 状态管理
│   │   ├── auth.js            # 认证状态管理
│   │   ├── user.js            # 用户状态管理
│   │   ├── system.js          # 系统状态管理
│   │   └── index.js           # Store入口
│   ├── utils/                 # 工具函数
│   │   ├── logger.js          # 日志工具
│   │   ├── request.js         # 请求封装
│   │   ├── constants.js       # 常量定义
│   │   ├── auth.js            # 认证工具
│   │   └── validators.js      # 表单验证器
│   ├── styles/                # 样式文件
│   │   ├── main.css           # 主样式
│   │   ├── variables.css      # CSS变量
│   │   └── antd-overrides.css # Ant Design样式覆盖
│   ├── App.vue                # 根组件
│   └── main.js                # 应用入口
├── tests/                     # 测试文件
├── .eslintrc.js               # ESLint配置
├── .prettierrc                # Prettier配置
├── vite.config.js             # Vite配置
└── package.json               # 依赖配置
```

## 实现细节

### 认证模块实现

#### 1. 登录页面 (Login.vue)
```vue
<template>
  <div class="login-container">
    <a-card class="login-card">
      <h2>系统登录</h2>
      <a-form
        :model="loginForm"
        :rules="loginRules"
        @finish="handleLogin"
        layout="vertical"
      >
        <a-form-item label="用户名" name="username">
          <a-input
            v-model:value="loginForm.username"
            placeholder="请输入用户名"
            size="large"
          >
            <template #prefix>
              <UserOutlined />
            </template>
          </a-input>
        </a-form-item>

        <a-form-item label="密码" name="password">
          <a-input-password
            v-model:value="loginForm.password"
            placeholder="请输入密码"
            size="large"
          >
            <template #prefix>
              <LockOutlined />
            </template>
          </a-input-password>
        </a-form-item>

        <a-form-item>
          <a-checkbox v-model:checked="loginForm.remember">
            记住我
          </a-checkbox>
        </a-form-item>

        <a-form-item>
          <a-button
            type="primary"
            html-type="submit"
            size="large"
            :loading="loading"
            block
          >
            登录
          </a-button>
        </a-form-item>
      </a-form>

      <div class="login-footer">
        <router-link to="/register">注册账号</router-link>
        <router-link to="/forgot-password">忘记密码</router-link>
      </div>
    </a-card>
  </div>
</template>

<script setup>
import { reactive, ref } from 'vue'
import { useRouter } from 'vue-router'
import { message } from 'ant-design-vue'
import { UserOutlined, LockOutlined } from '@ant-design/icons-vue'
import { useAuthStore } from '@/store/auth'
import { logger } from '@/utils/logger'

const router = useRouter()
const authStore = useAuthStore()
const loading = ref(false)

const loginForm = reactive({
  username: '',
  password: '',
  remember: false
})

const loginRules = {
  username: [
    { required: true, message: '请输入用户名' },
    { min: 3, max: 20, message: '用户名长度为3-20个字符' }
  ],
  password: [
    { required: true, message: '请输入密码' },
    { min: 6, max: 50, message: '密码长度为6-50个字符' }
  ]
}

const handleLogin = async () => {
  loading.value = true
  try {
    await authStore.login(loginForm)
    message.success('登录成功')
    router.push('/dashboard')
  } catch (error) {
    logger.error('登录失败:', error)
    message.error(error.message || '登录失败')
  } finally {
    loading.value = false
  }
}
</script>
```

#### 2. 认证状态管理 (store/auth.js)
```javascript
import { defineStore } from 'pinia'
import { authApi } from '@/api/auth'
import { removeToken, setToken, getToken } from '@/utils/auth'
import { logger } from '@/utils/logger'

export const useAuthStore = defineStore('auth', {
  state: () => ({
    token: getToken(),
    user: null,
    permissions: [],
    roles: []
  }),

  getters: {
    isAuthenticated: (state) => !!state.token,
    hasRole: (state) => (role) => state.roles.includes(role),
    hasPermission: (state) => (permission) => state.permissions.includes(permission)
  },

  actions: {
    async login(credentials) {
      logger.info('开始登录', { username: credentials.username })

      try {
        const response = await authApi.login(credentials)
        const { access_token, user, permissions, roles } = response.data

        this.token = access_token
        this.user = user
        this.permissions = permissions
        this.roles = roles

        setToken(access_token)

        logger.info('登录成功', { userId: user.id })
      } catch (error) {
        logger.error('登录失败', error)
        throw error
      }
    },

    async logout() {
      logger.info('用户登出', { userId: this.user?.id })

      try {
        await authApi.logout()
      } catch (error) {
        logger.warn('登出请求失败', error)
      } finally {
        this.token = null
        this.user = null
        this.permissions = []
        this.roles = []
        removeToken()
      }
    },

    async refreshToken() {
      try {
        const response = await authApi.refreshToken()
        const { access_token } = response.data

        this.token = access_token
        setToken(access_token)

        return access_token
      } catch (error) {
        logger.error('刷新Token失败', error)
        await this.logout()
        throw error
      }
    },

    async fetchUserInfo() {
      try {
        const response = await authApi.getUserInfo()
        const { user, permissions, roles } = response.data

        this.user = user
        this.permissions = permissions
        this.roles = roles

        return user
      } catch (error) {
        logger.error('获取用户信息失败', error)
        throw error
      }
    }
  }
})
```

### 用户管理模块实现

#### 1. 用户列表页面 (views/users/UserList.vue)
```vue
<template>
  <div class="user-list">
    <!-- 搜索表单 -->
    <a-card class="search-card">
      <a-form :model="searchForm" layout="inline">
        <a-form-item label="用户名">
          <a-input
            v-model:value="searchForm.username"
            placeholder="请输入用户名"
            allow-clear
          />
        </a-form-item>

        <a-form-item label="邮箱">
          <a-input
            v-model:value="searchForm.email"
            placeholder="请输入邮箱"
            allow-clear
          />
        </a-form-item>

        <a-form-item label="状态">
          <a-select
            v-model:value="searchForm.is_active"
            placeholder="请选择状态"
            allow-clear
            style="width: 120px"
          >
            <a-select-option :value="true">启用</a-select-option>
            <a-select-option :value="false">禁用</a-select-option>
          </a-select>
        </a-form-item>

        <a-form-item>
          <a-button type="primary" @click="handleSearch">
            <template #icon><SearchOutlined /></template>
            搜索
          </a-button>
          <a-button @click="handleReset">重置</a-button>
        </a-form-item>
      </a-form>
    </a-card>

    <!-- 用户表格 -->
    <a-card>
      <template #title>
        用户列表
        <a-button
          type="primary"
          @click="$router.push('/users/create')"
          style="float: right"
        >
          <template #icon><PlusOutlined /></template>
          新增用户
        </a-button>
      </template>

      <a-table
        :columns="columns"
        :data-source="users"
        :pagination="pagination"
        :loading="loading"
        @change="handleTableChange"
        row-key="id"
      >
        <template #bodyCell="{ column, record }">
          <template v-if="column.key === 'avatar'">
            <a-avatar :src="record.avatar" :alt="record.username">
              {{ record.username.charAt(0).toUpperCase() }}
            </a-avatar>
          </template>

          <template v-else-if="column.key === 'roles'">
            <a-tag
              v-for="role in record.roles"
              :key="role.id"
              :color="getRoleColor(role.name)"
            >
              {{ role.description }}
            </a-tag>
          </template>

          <template v-else-if="column.key === 'is_active'">
            <a-tag :color="record.is_active ? 'green' : 'red'">
              {{ record.is_active ? '启用' : '禁用' }}
            </a-tag>
          </template>

          <template v-else-if="column.key === 'last_login'">
            {{ formatDateTime(record.last_login) }}
          </template>

          <template v-else-if="column.key === 'action'">
            <a-space>
              <a-button type="link" @click="handleView(record)">
                查看
              </a-button>
              <a-button type="link" @click="handleEdit(record)">
                编辑
              </a-button>
              <a-switch
                :checked="record.is_active"
                @change="(checked) => handleToggleStatus(record, checked)"
                size="small"
              />
              <a-popconfirm
                title="确定删除这个用户吗？"
                @confirm="handleDelete(record)"
              >
                <a-button type="link" danger>删除</a-button>
              </a-popconfirm>
            </a-space>
          </template>
        </template>
      </a-table>
    </a-card>
  </div>
</template>

<script setup>
import { ref, reactive, onMounted } from 'vue'
import { message } from 'ant-design-vue'
import {
  SearchOutlined,
  PlusOutlined
} from '@ant-design/icons-vue'
import { userApi } from '@/api/user'
import { formatDateTime } from '@/utils/formatters'
import { logger } from '@/utils/logger'

const loading = ref(false)
const users = ref([])

const searchForm = reactive({
  username: '',
  email: '',
  is_active: undefined
})

const pagination = reactive({
  current: 1,
  pageSize: 10,
  total: 0,
  showSizeChanger: true,
  showQuickJumper: true
})

const columns = [
  {
    title: '头像',
    key: 'avatar',
    width: 80
  },
  {
    title: '用户名',
    dataIndex: 'username',
    key: 'username',
    sorter: true
  },
  {
    title: '邮箱',
    dataIndex: 'email',
    key: 'email'
  },
  {
    title: '全名',
    dataIndex: 'full_name',
    key: 'full_name'
  },
  {
    title: '角色',
    key: 'roles'
  },
  {
    title: '状态',
    key: 'is_active',
    width: 100
  },
  {
    title: '最后登录',
    key: 'last_login',
    width: 180
  },
  {
    title: '操作',
    key: 'action',
    width: 200
  }
]

const fetchUsers = async () => {
  loading.value = true
  try {
    const params = {
      page: pagination.current,
      size: pagination.pageSize,
      ...searchForm
    }

    const response = await userApi.getUsers(params)
    const { items, total } = response.data

    users.value = items
    pagination.total = total

    logger.info('获取用户列表成功', { count: items.length })
  } catch (error) {
    logger.error('获取用户列表失败', error)
    message.error('获取用户列表失败')
  } finally {
    loading.value = false
  }
}

const handleSearch = () => {
  pagination.current = 1
  fetchUsers()
}

const handleReset = () => {
  Object.keys(searchForm).forEach(key => {
    searchForm[key] = key === 'is_active' ? undefined : ''
  })
  handleSearch()
}

const handleTableChange = (pag, filters, sorter) => {
  pagination.current = pag.current
  pagination.pageSize = pag.pageSize
  fetchUsers()
}

const handleView = (user) => {
  router.push(`/users/${user.id}`)
}

const handleEdit = (user) => {
  router.push(`/users/${user.id}/edit`)
}

const handleToggleStatus = async (user, isActive) => {
  try {
    await userApi.updateUser(user.id, { is_active: isActive })
    user.is_active = isActive
    message.success(`用户已${isActive ? '启用' : '禁用'}`)
    logger.info('用户状态更新成功', { userId: user.id, isActive })
  } catch (error) {
    logger.error('用户状态更新失败', error)
    message.error('操作失败')
  }
}

const handleDelete = async (user) => {
  try {
    await userApi.deleteUser(user.id)
    message.success('用户删除成功')
    fetchUsers()
    logger.info('用户删除成功', { userId: user.id })
  } catch (error) {
    logger.error('用户删除失败', error)
    message.error('删除失败')
  }
}

const getRoleColor = (roleName) => {
  const colors = {
    'super_admin': 'red',
    'admin': 'blue',
    'user': 'green'
  }
  return colors[roleName] || 'default'
}

onMounted(() => {
  fetchUsers()
})
</script>
```

### 路由配置和权限守卫

#### 1. 路由配置 (router/index.js)
```javascript
import { createRouter, createWebHistory } from 'vue-router'
import { useAuthStore } from '@/store/auth'
import { logger } from '@/utils/logger'

const routes = [
  {
    path: '/login',
    name: 'Login',
    component: () => import('@/views/auth/Login.vue'),
    meta: { requiresAuth: false }
  },
  {
    path: '/register',
    name: 'Register',
    component: () => import('@/views/auth/Register.vue'),
    meta: { requiresAuth: false }
  },
  {
    path: '/forgot-password',
    name: 'ForgotPassword',
    component: () => import('@/views/auth/ForgotPassword.vue'),
    meta: { requiresAuth: false }
  },
  {
    path: '/',
    component: () => import('@/components/layout/MainLayout.vue'),
    meta: { requiresAuth: true },
    children: [
      {
        path: '',
        redirect: '/dashboard'
      },
      {
        path: 'dashboard',
        name: 'Dashboard',
        component: () => import('@/views/dashboard/Index.vue'),
        meta: {
          requiresAuth: true,
          permission: 'dashboard:read'
        }
      },
      {
        path: 'users',
        name: 'UserList',
        component: () => import('@/views/users/UserList.vue'),
        meta: {
          requiresAuth: true,
          permission: 'user:read'
        }
      },
      {
        path: 'users/:id',
        name: 'UserDetail',
        component: () => import('@/views/users/UserDetail.vue'),
        meta: {
          requiresAuth: true,
          permission: 'user:read'
        }
      },
      {
        path: 'users/:id/edit',
        name: 'UserEdit',
        component: () => import('@/views/users/UserEdit.vue'),
        meta: {
          requiresAuth: true,
          permission: 'user:update'
        }
      },
      {
        path: 'roles',
        name: 'RoleList',
        component: () => import('@/views/roles/RoleList.vue'),
        meta: {
          requiresAuth: true,
          permission: 'role:read'
        }
      },
      {
        path: 'system/logs',
        name: 'SystemLogs',
        component: () => import('@/views/system/Logs.vue'),
        meta: {
          requiresAuth: true,
          permission: 'log:read'
        }
      },
      {
        path: 'profile',
        name: 'Profile',
        component: () => import('@/views/profile/Profile.vue'),
        meta: { requiresAuth: true }
      }
    ]
  },
  {
    path: '/:pathMatch(.*)*',
    name: 'NotFound',
    component: () => import('@/views/error/NotFound.vue')
  }
]

const router = createRouter({
  history: createWebHistory(),
  routes
})

// 全局前置守卫
router.beforeEach(async (to, from, next) => {
  const authStore = useAuthStore()

  logger.debug('路由导航', { from: from.path, to: to.path })

  // 检查是否需要认证
  if (to.meta.requiresAuth) {
    if (!authStore.isAuthenticated) {
      logger.warn('未认证用户访问受保护路由', { path: to.path })
      next({
        path: '/login',
        query: { redirect: to.fullPath }
      })
      return
    }

    // 检查权限
    if (to.meta.permission && !authStore.hasPermission(to.meta.permission)) {
      logger.warn('用户权限不足', {
        path: to.path,
        permission: to.meta.permission
      })
      next('/403')
      return
    }
  }

  next()
})

export default router
```

### API请求封装

#### 1. 请求配置 (api/index.js)
```javascript
import axios from 'axios'
import { message } from 'ant-design-vue'
import { useAuthStore } from '@/store/auth'
import { logger } from '@/utils/logger'
import { getToken } from '@/utils/auth'

// 创建axios实例
const request = axios.create({
  baseURL: import.meta.env.VITE_API_BASE_URL || '/api',
  timeout: 10000,
  headers: {
    'Content-Type': 'application/json'
  }
})

// 请求拦截器
request.interceptors.request.use(
  (config) => {
    const token = getToken()
    if (token) {
      config.headers.Authorization = `Bearer ${token}`
    }

    logger.debug('API请求', {
      method: config.method?.toUpperCase(),
      url: config.url,
      data: config.data
    })

    return config
  },
  (error) => {
    logger.error('请求拦截器错误', error)
    return Promise.reject(error)
  }
)

// 响应拦截器
request.interceptors.response.use(
  (response) => {
    logger.debug('API响应', {
      status: response.status,
      url: response.config.url
    })

    return response
  },
  async (error) => {
    const { response } = error
    const authStore = useAuthStore()

    logger.error('API响应错误', {
      status: response?.status,
      url: response?.config?.url,
      message: error.message
    })

    // Token过期处理
    if (response?.status === 401) {
      try {
        await authStore.refreshToken()
        // 重新发送原请求
        return request(response.config)
      } catch (refreshError) {
        authStore.logout()
        router.push('/login')
        message.error('登录已过期，请重新登录')
      }
    }

    // 其他错误处理
    if (response?.status >= 500) {
      message.error('服务器错误，请稍后重试')
    } else if (response?.status === 403) {
      message.error('权限不足')
    } else if (response?.data?.message) {
      message.error(response.data.message)
    }

    return Promise.reject(error)
  }
)

export default request
```

### 日志系统实现

#### 1. 日志工具使用 (utils/logger.js的使用)
```javascript
import { logger, createLogger, createApiLogger, createPerformanceLogger } from '@/utils/logger'

// 默认日志使用
logger.info('用户登录成功')
logger.error('API请求失败', error)

// 命名日志器
const componentLogger = createLogger('UserList')
componentLogger.debug('组件初始化')

// API日志器
const apiLogger = createApiLogger()
apiLogger.request('GET', '/api/users')
apiLogger.response('GET', '/api/users', 200, users, 150)

// 性能日志器
const perfLogger = createPerformanceLogger('UserList')
const timer = perfLogger.startTimer('获取用户数据')
// ... 执行操作
timer.end()
```

### 构建配置

#### 1. Vite配置 (vite.config.js)
```javascript
import { defineConfig } from 'vite'
import vue from '@vitejs/plugin-vue'
import { resolve } from 'path'

export default defineConfig({
  plugins: [vue()],

  resolve: {
    alias: {
      '@': resolve(__dirname, 'src')
    }
  },

  server: {
    port: 3000,
    open: true,
    proxy: {
      '/api': {
        target: 'http://localhost:8000',
        changeOrigin: true,
        secure: false
      }
    }
  },

  build: {
    outDir: 'dist',
    sourcemap: true,
    rollupOptions: {
      output: {
        chunkFileNames: 'js/[name]-[hash].js',
        entryFileNames: 'js/[name]-[hash].js',
        assetFileNames: '[ext]/[name]-[hash].[ext]'
      }
    }
  },

  define: {
    __VUE_PROD_DEVTOOLS__: false
  }
})
```

### 样式规范

#### 1. CSS变量定义 (styles/variables.css)
```css
:root {
  /* 主色调 */
  --primary-color: #1890ff;
  --primary-color-hover: #40a9ff;
  --primary-color-active: #096dd9;

  /* 辅助色 */
  --success-color: #52c41a;
  --warning-color: #faad14;
  --error-color: #ff4d4f;
  --info-color: #1890ff;

  /* 文本颜色 */
  --text-color: #262626;
  --text-color-secondary: #595959;
  --text-color-disabled: #bfbfbf;

  /* 背景色 */
  --background-color: #f0f2f5;
  --background-color-light: #fafafa;

  /* 边框 */
  --border-color: #d9d9d9;
  --border-radius: 6px;

  /* 阴影 */
  --box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);

  /* 间距 */
  --spacing-xs: 4px;
  --spacing-sm: 8px;
  --spacing-md: 16px;
  --spacing-lg: 24px;
  --spacing-xl: 32px;
}
```

### 开发规范

#### 1. 组件命名规范
- 组件文件名使用PascalCase：`UserList.vue`
- 组件在模板中使用kebab-case：`<user-list>`
- 组件props使用camelCase

#### 2. 代码风格
- 使用Composition API和setup语法糖
- 优先使用ref而非reactive（基本类型）
- 合理使用computed和watch
- 提取可复用的逻辑到composables

#### 3. 状态管理规范
- 按功能模块划分store
- 使用action处理异步操作
- 使用getter计算派生状态
- 保持state的扁平化结构

#### 4. 错误处理规范
- 使用try-catch处理异步操作
- 统一的错误提示信息
- 记录详细的错误日志
- 友好的用户界面反馈